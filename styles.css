// Danh sách sản phẩm
const productsData = [
  {name:"Áo Thun Trắng", price:120000, img:"https://i.ibb.co/xSS2tx7f/IMG-1004.jpg"},
  {name:"Áo Thun Đen", price:130000, img:"https://i.ibb.co/7NkMdW03/IMG-1005.jpg"},
  {name:"Quần Jeans Xanh", price:250000, img:"https://i.ibb.co/svKG0Vv0/IMG-1011.jpg"},
  {name:"Áo Khoác", price:350000, img:"https://i.ibb.co/rGkprzVg/IMG-1014.jpg"},
  {name:"Váy Nữ", price:300000, img:"https://i.ibb.co/C3gbFfMK/IMG-1013.jpg"},
  {name:"Quần Short", price:150000, img:"https://i.ibb.co/S7ZPzGy8/IMG-1012.jpg"},
  {name:"Áo Sơ Mi", price:200000, img:"https://i.ibb.co/cch8nF6Z/IMG-1016.jpg"},
  {name:"Giày Thể Thao", price:400000, img:"https://i.ibb.co/gFbHrSzw/IMG-1015.jpg"}
];

let cart = [];
let users = JSON.parse(localStorage.getItem('users') || '[]');
let currentUser = localStorage.getItem('currentUser');

function renderUserInfo(){
    document.getElementById('user-info').textContent = currentUser?`Xin chào: ${currentUser}`:'';
}
renderUserInfo();

function showLogin(){ document.getElementById('login-form').style.display='block'; document.getElementById('register-form').style.display='none'; }
function showRegister(){ document.getElementById('register-form').style.display='block'; document.getElementById('login-form').style.display='none'; }

function register(){
    let phone = document.getElementById('reg-phone').value.trim();
    let pass = document.getElementById('reg-pass').value;
    let pass2 = document.getElementById('reg-pass2').value;
    if(!phone){ alert("Nhập số điện thoại"); return;}
    if(pass!==pass2){ alert("Mật khẩu không khớp"); return;}
    if(users.find(u=>u.phone===phone)){ alert("SĐT đã tồn tại"); return;}
    users.push({phone,pass});
    localStorage.setItem('users', JSON.stringify(users));
    alert("Đăng ký thành công");
    showLogin();
}

function login(){
    let phone = document.getElementById('login-phone').value.trim();
    let pass = document.getElementById('login-pass').value;
    let user = users.find(u=>u.phone===phone && u.pass===pass);
    if(user){
        alert("Đăng nhập thành công");
        currentUser = phone;
        localStorage.setItem('currentUser', currentUser);
        renderUserInfo();
        document.getElementById('login-form').style.display='none';
    } else { alert("SĐT hoặc mật khẩu sai"); }
}

// Render sản phẩm
function renderProducts(){
    const container = document.getElementById('products');
    container.innerHTML = '';
    productsData.forEach((p,i)=>{
        let div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `<img src="${p.img}" alt="${p.name}"><h4>${p.name}</h4><p>${p.price}đ</p><button onclick="addToCart(${i})">Thêm vào giỏ</button>`;
        container.appendChild(div);
    });
}
renderProducts();

// Giỏ hàng
function renderCart(){
    const ul = document.getElementById('cart-items');
    ul.innerHTML = '';
    let total = 0;
    cart.forEach((item,i)=>{
        total += item.price;
        let li = document.createElement('li');
        li.textContent = `${item.name} - ${item.price}đ`;
        ul.appendChild(li);
    });
    document.getElementById('total').textContent = total;
}

function addToCart(index){
    cart.push(productsData[index]);
    renderCart();
    showPopup(`${productsData[index].name} đã thêm vào giỏ`);
}

function clearCart(){ cart=[]; renderCart(); showPopup("Giỏ hàng đã xóa","red"); }

function checkout(){
    if(!currentUser){ showPopup("Đăng nhập trước!","red"); return;}
    if(cart.length===0){ showPopup("Giỏ hàng trống","red"); return;}
    alert("Thanh toán COD / chuyển khoản:\n" + cart.map(c=>c.name).join(", ") + "\nTổng: "+cart.reduce((sum,i)=>sum+i.price,0)+"đ");
    cart=[]; renderCart();
}

function showPopup(message,color="#27ae60"){
    const popup = document.getElementById('popup');
    popup.style.background = color;
    popup.textContent = message;
    popup.style.display = "block";
    setTimeout(()=>popup.style.display="none",2500);
}
